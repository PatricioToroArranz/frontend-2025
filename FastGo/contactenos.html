<!DOCTYPE html>
<html lang="es"> <!-- establece el idioma español -->
<head>
    <meta charset="UTF-8"> <!-- especifica la codificación de caracteres a UTF-8 para admitir caracteres especiales -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- asegurar la adaptabilidad en dispositivos móviles -->
    <title>Contáctenos - FastGo</title> <!-- Título que aparece en la pestaña del navegador -->


    <!-- Define el icono de la pestaña del navegador utilizando un SVG codificado en base64 para un logo simple "FG" -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext x='50%25' y='50%25' dominant-baseline='central' text-anchor='middle' font-size='90' fill='%23007bff' font-family='Arial, sans-serif'%3EFG%3C/text%3E%3C/svg%3E" type="image/svg+xml">

  
    <!-- Enlaza la hoja de estilos CSS de Bootstrap 4.5.3 desde un CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" crossorigin="anonymous">

   
    <!-- Enlaza la fuente Montserrat de Google Fonts para el estilo del texto -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Enlaza la hoja de estilos CSS-->
    <link rel="stylesheet" href="style.css">

    
</head>
<body>

   
    <nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top shadow-sm"> <!-- Barra de navegación de Bootstrap: expandible, clara, fondo blanco, fija arriba, con sombra -->
        <div class="container"> <!-- Contenedor para centrar el contenido de la barra de navegación -->
            <a class="navbar-brand" href="index.html"> <!-- Enlace de la marca/logo que al hacer clic lleva a la sección "home" -->
                <!-- SVG de un rayo simple para el logo, representando velocidad -->
                <svg class="logo-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"> <!-- Icono SVG de un rayo, parte del logo -->
                    <path d="M13 2L3 14H12L11 22L21 10H12L13 2Z" fill="#007bff"/> <!-- Ruta del SVG que forma el rayo, con color azul -->
                </svg>
                FastGo <!-- Texto de la marca -->
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <!-- Botón para el menú hamburguesa en móviles -->
                <span class="navbar-toggler-icon"></span> <!-- Icono del menú hamburguesa -->
            </button>
            <div class="collapse navbar-collapse" id="navbarNav"> <!-- Contenedor colapsable del menú de navegación para móviles -->
                <ul class="navbar-nav ml-auto"> <!-- Lista de enlaces de navegación, alineada a la derecha (ml-auto) -->
                    <li class="nav-item"> <!-- Elemento de la lista para el enlace de inicio -->
                        <a class="nav-link" href="index.html">Inicio</a> <!-- Enlace a la sección de Inicio -->
                    </li>
                    <li class="nav-item"> <!-- Elemento de la lista para el enlace "Sobre Nosotros" -->
                        <a class="nav-link" href="sobre-nosotros.html">Sobre Nosotros</a> <!-- Enlaza a la sección "Sobre Nosotros" -->
                    </li>
                    <li class="nav-item"> <!-- Elemento de la lista para el enlace "Servicios" -->
                        <a class="nav-link" href="servicios.html">Servicios</a> <!-- Enlaza a la sección de Servicios -->
                    </li>
                    <li class="nav-item active"> <!-- Elemento de la lista para el enlace "Contáctenos" (activo en esta página) -->
                        <a class="nav-link" href="contactenos.html">Contáctenos <span class="sr-only">(current)</span></a> <!-- Enlaza a la sección de Contáctenos -->
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <h2 class="mb-4">Nuevo Contacto</h2>
        <form id="contactForm" novalidate> 
            <input type="hidden" id="recordId" value=""> 

            <div class="form-group">
                <label for="inputName">Nombre Completo (*)</label>
                <input type="text" class="form-control" id="inputName" placeholder="Tu nombre" required>
                <div class="invalid-feedback">
                    Por favor, ingresa tu nombre completo.
                </div>
            </div>

            <div class="form-group">
                <label for="inputPhone">Teléfono (*)</label>
                <input type="tel" class="form-control" id="inputPhone" placeholder="Ej: +56 9 1234 5678" required>
                <div class="invalid-feedback">
                    Por favor, ingresa un número de teléfono.
                </div>
            </div>

            <div class="form-group">
                <label for="inputEmail">Email (*)</label>
                <input type="email" class="form-control" id="inputEmail" placeholder="name@example.com" required>
                <div class="invalid-feedback">
                    Por favor, ingresa un correo electrónico válido.
                </div>
            </div>

            <div class="form-group">
                <label for="selectCountry">País (*)</label>
                <select class="form-control" id="selectCountry" required>
                    <option value="">Cargando países...</option>
                </select>
                <div class="invalid-feedback">
                    Por favor, selecciona un país.
                </div>
            </div>

            <div class="form-group" id="containerOfficialCountryName">
                <label for="inputOfficialCountryName">Nombre Oficial del País</label>
                <input type="text" class="form-control" id="inputOfficialCountryName" readonly />
            </div>

            <div class="form-group">
                <label for="textareaComentario">Comentarios (*)</label>
                <textarea class="form-control" id="textareaComentario" rows="3" required></textarea>
                <div class="invalid-feedback">
                    Por favor, ingresa un comentario.
                </div>
            </div>

            <div id="div-errores" class="alert alert-danger" style="display: none;">
                <ul id="lista-errores"></ul>
            </div>

            <div class="form-group">
                <small>(*) Campos obligatorios</small><br/><br/>
                <button class="btn btn-sm btn-warning" id="buttonClean" type="button">Limpiar</button>&nbsp;
                <button class="btn btn-sm btn-primary" type="submit" id="submitBtn">Enviar Formulario</button>
                <button class="btn btn-sm btn-secondary ml-2 d-none" type="button" id="cancelEditBtn">Cancelar Edición</button>
            </div>
        </form>

        <hr class="my-5">

        <h2 class="mb-4">Listado Contactos</h2>
        <div id="contactRecordsContainer" class="row">
            <div class="col-12 text-center" id="mensaje-sin-contactos" style="display:none">
                <div class="alert alert-warning">No hay contactos para mostrar.</div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    
    <script>
        // Espera a que el DOM esté completamente cargado antes de ejecutar el script.
        $(document).ready(function(){
            // Define una constante para la clave de LocalStorage.
            const LOCAL_STORAGE_KEY = 'contactos'; 
            // Carga los contactos existentes desde LocalStorage o inicializa un array vacío si no hay.
            let dataBase = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEY)) || [];
            // Array para almacenar los datos completos de los países obtenidos de la API.
            let countriesData = []; 

            // --- Funciones auxiliares ---

            // Función para obtener el nombre oficial de un país dado su código ISO.
            function getOfficialCountryName(countryCode) {
                // Busca el país en el array 'countriesData' por su código ISO (cca2).
                const country = countriesData.find(c => c.cca2 === countryCode);
                // Retorna el nombre oficial en español si existe, de lo contrario, el nombre oficial en inglés o una cadena vacía.
                return country ? (country.translations.spa ? country.translations.spa.official : country.name.official) : '';
            }

            // Función para cargar la lista de países desde la API REST Countries.
            function loadCountries() {
                // Realiza una solicitud AJAX (Asynchronous JavaScript and XML) GET a la API.
                $.ajax({
                    url: 'https://restcountries.com/v3.1/lang/spanish', // URL de la API para países que hablan español.
                    method: 'GET', // Método HTTP de la solicitud.
                    success: function(data) {
                        // Se ejecuta si la solicitud es exitosa.
                        // Almacena los datos completos y los ordena alfabéticamente por su nombre común en español.
                        countriesData = data.sort((a, b) => {
                            const nameA = a.translations.spa ? a.translations.spa.common : a.name.common;
                            const nameB = b.translations.spa ? b.translations.spa.common : b.name.common;
                            return nameA.localeCompare(nameB); // Compara los nombres para ordenar.
                        });

                        // Selecciona el elemento <select> con ID 'selectCountry'.
                        const $countrySelect = $('#selectCountry');
                        $countrySelect.empty(); // Limpia cualquier opción existente.
                        // Añade la opción por defecto.
                        $countrySelect.append('<option value="">Seleccione País</option>');
                        
                        // Itera sobre cada país obtenido y añade una opción al selector.
                        countriesData.forEach(function(country){
                            // Obtiene el nombre común del país en español.
                            const countryName = country.translations.spa ? country.translations.spa.common : country.name.common;
                            // Añade la opción, usando el código ISO (cca2) como valor y el nombre común como texto visible.
                            $countrySelect.append(`<option value="${country.cca2}">${countryName}</option>`);
                        });
                        // Si la API carga correctamente, elimina cualquier campo de entrada de 'otro país' si existiera.
                        // $('#otherCountry').remove(); 
                    },
                    error: function() {
                        // Se ejecuta si la solicitud falla.
                        alert("No se pudo cargar la lista de países desde la API. Por favor, recarga la página o intenta más tarde.");
                        // Muestra un mensaje de error en el selector de país.
                        $('#selectCountry').empty().append('<option value="">Error al cargar países</option>');
                    }
                });
            }

            // Llama a la función para cargar los países al iniciar la aplicación.
            loadCountries();



            // Escucha el evento 'change' en el selector de país.
            $('#selectCountry').on('change', function() {
                // Obtiene el código del país seleccionado.
                const selectedCountryCode = $(this).val();
                if (selectedCountryCode) {
                    // Si se seleccionó un país, llena el campo 'Nombre Oficial del País'.
                    $('#inputOfficialCountryName').val(getOfficialCountryName(selectedCountryCode));
                    // Muestra el contenedor del campo de nombre oficial.
                    $('#containerOfficialCountryName').show(); 
                } else {
                    // Si no se seleccionó ningún país, limpia el campo y lo oculta.
                    $('#inputOfficialCountryName').val('');
                    $('#containerOfficialCountryName').hide(); 
                }
            });

            // Función para mostrar/actualizar los registros de contacto en la interfaz.
            function displayRecords() {
                // Obtiene los registros actuales de LocalStorage.
                const records = getRecords();
                // Selecciona el contenedor donde se mostrarán las tarjetas de contacto.
                const $container = $('#contactRecordsContainer');
                $container.empty(); // Limpia el contenido actual del contenedor.

                if (records.length === 0) {
                    // Si no hay registros, muestra el mensaje de "No hay contactos".
                    $('#mensaje-sin-contactos').show();
                } else {
                    // Si hay registros, oculta el mensaje de "No hay contactos".
                    $('#mensaje-sin-contactos').hide();
                    // Itera sobre cada registro y crea una tarjeta para mostrarlo.
                    records.forEach(record => {
                        const cardHtml = `
                            <div class="col-md-6 col-lg-4 mb-4">
                                <div class="card h-100">
                                    <div class="card-body">
                                        <h5 class="card-title">${record.name || 'Sin Nombre'}</h5>
                                        <p class="card-text"><strong>Teléfono:</strong> ${record.phone || 'N/A'}</p>
                                        <p class="card-text"><strong>Email:</strong> ${record.email}</p>
                                        <p class="card-text"><strong>País:</strong> ${record.countryName || record.pais} (${record.officialCountryName || 'N/A'})</p>
                                        <p class="card-text"><strong>Comentarios:</strong> ${record.comentarios}</p>
                                        <button class="btn btn-info btn-sm edit-btn" data-id="${record.id}">Editar</button>
                                        <button class="btn btn-danger btn-sm delete-btn ml-2" data-id="${record.id}">Eliminar</button>
                                    </div>
                                </div>
                            </div>
                        `;
                        $container.append(cardHtml); // Añade la tarjeta al contenedor.
                    });
                }
            }

            // Función para obtener los registros de LocalStorage.
            function getRecords() {
                // Obtiene la cadena JSON de LocalStorage.
                const records = localStorage.getItem(LOCAL_STORAGE_KEY);
                // Parsea la cadena a un objeto JavaScript o devuelve un array vacío si no hay datos.
                return records ? JSON.parse(records) : [];
            }

            // Función para guardar los registros en LocalStorage.
            function saveRecords(records) {
                // Convierte el array de objetos JavaScript a una cadena JSON y la guarda en LocalStorage.
                localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(records));
            }

            // Muestra los registros existentes al cargar la página por primera vez.
            displayRecords();

            // Escucha el evento 'click' en el botón 'Limpiar'.
            $('#buttonClean').on('click', function() {
                // Pide confirmación al usuario antes de limpiar el formulario.
                if (confirm('¿Está seguro que desea limpiar el formulario?')) {
                    $('#contactForm')[0].reset(); // Resetea todos los campos del formulario.
                    $('#inputOfficialCountryName').val(''); // Limpia manualmente el campo oficial del país.
                    $('#recordId').val(''); // Limpia el ID del registro en edición.
                    $('#submitBtn').text('Enviar Formulario'); // Restaura el texto del botón de envío.
                    $('#cancelEditBtn').addClass('d-none'); // Oculta el botón de cancelar edición.
                    // Elimina las clases de validación de Bootstrap de todos los campos.
                    $('#contactForm').find('.form-control').removeClass('is-invalid is-valid');
                    $('#div-errores').hide(); // Oculta el contenedor de mensajes de error generales.
                    $('#lista-errores').empty(); // Limpia la lista de errores.
                }
            });

            // Escucha el evento 'submit' del formulario de contacto.
            $('#contactForm').submit(function(e) {
                e.preventDefault(); // Previene el envío predeterminado del formulario HTML.

                const $form = $(this); // Referencia al formulario.
                let isValid = true; // Bandera para controlar si el formulario es válido.
                const errorsList = $('#lista-errores'); // Referencia a la lista de errores generales.
                errorsList.empty(); // Limpia la lista de errores previos.
                $('#div-errores').hide(); // Oculta el contenedor de errores al inicio de la validación.

                // Limpia las clases de validación de Bootstrap de todos los campos.
                $form.find('.form-control').removeClass('is-invalid is-valid');

                // --- Validaciones de cada campo ---
                const inputName = $('#inputName');
                const inputPhone = $('#inputPhone');
                const inputEmail = $('#inputEmail');
                const selectCountry = $('#selectCountry');
                const textareaComentario = $('#textareaComentario');

                // Validación del campo Nombre.
                if (inputName.val().trim() === '') {
                    inputName.addClass('is-invalid'); // Añade clase de Bootstrap para indicar error.
                    errorsList.append('<li>El nombre está vacío.</li>'); // Añade error a la lista general.
                    isValid = false; // Marca el formulario como inválido.
                } else {
                    inputName.addClass('is-valid'); // Añade clase de Bootstrap para indicar éxito.
                }

                // Validación del campo Teléfono.
                if (inputPhone.val().trim() === '') {
                    inputPhone.addClass('is-invalid');
                    errorsList.append('<li>El teléfono está vacío.</li>');
                    isValid = false;
                } else {
                    inputPhone.addClass('is-valid');
                }

                // Validación del campo Email.
                if (inputEmail.val().trim() === '') {
                    inputEmail.addClass('is-invalid');
                    errorsList.append('<li>El email está vacío.</li>');
                    isValid = false;
                } else {
                    // Expresión regular para validar el formato de email.
                    const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!regex.test(inputEmail.val().trim())) {
                        inputEmail.addClass('is-invalid');
                        errorsList.append('<li>El email no tiene un formato válido.</li>');
                        isValid = false;
                    } else {
                        inputEmail.addClass('is-valid');
                    }
                }

                // Validación del campo País.
                if (selectCountry.val() === '') {
                    selectCountry.addClass('is-invalid');
                    errorsList.append('<li>Seleccione un país.</li>');
                    isValid = false;
                } else {
                    selectCountry.addClass('is-valid');
                }

                // Validación del campo Comentarios.
                if (textareaComentario.val().trim() === '') {
                    textareaComentario.addClass('is-invalid');
                    errorsList.append('<li>Debe ingresar un comentario.</li>');
                    isValid = false;
                } else {
                    textareaComentario.addClass('is-valid');
                }

                // Si 'isValid' es falso (hay errores), muestra el div de errores y detiene la función.
                if (!isValid) {
                    $('#div-errores').show();
                    return; 
                }

                // --- Recopilación y Almacenamiento de Datos ---

                // Obtiene el ID del registro actual (si se está editando) o genera uno nuevo.
                const id = $('#recordId').val() || Date.now(); 
                // Obtiene los valores de todos los campos del formulario.
                const name = inputName.val().trim();
                const phone = inputPhone.val().trim();
                const email = inputEmail.val().trim();
                const countryCode = selectCountry.val();
                const countryName = selectCountry.find('option:selected').text(); // Nombre común del país.
                const officialCountryName = $('#inputOfficialCountryName').val().trim();
                const comentarios = textareaComentario.val().trim();

                // Crea un objeto con los datos del contacto.
                const newContact = {
                    id: id,
                    name: name,
                    phone: phone,
                    email: email,
                    countryCode: countryCode, // Guarda el código del país para rellenar el select al editar.
                    countryName: countryName, // Guarda el nombre común para mostrarlo.
                    officialCountryName: officialCountryName,
                    comentarios: comentarios
                };

                let records = getRecords(); // Obtiene la lista actual de registros.

                if ($('#recordId').val()) { // Si el campo 'recordId' tiene un valor, se está editando.
                    // Mapea el array de registros y actualiza el que coincide con el ID.
                    records = records.map(record => (record.id == id) ? newContact : record);
                    alert('Registro actualizado con éxito!'); // Mensaje de éxito para actualización.
                } else { // Si 'recordId' está vacío, es un nuevo registro.
                    records.push(newContact); // Añade el nuevo contacto al array.
                    alert('Contacto guardado exitosamente!'); // Mensaje de éxito para nuevo registro.
                }

                saveRecords(records); // Guarda el array actualizado en LocalStorage.
                displayRecords(); // Vuelve a mostrar la lista de registros en la interfaz.

                // --- Limpieza y Restablecimiento del Formulario ---
                $('#contactForm')[0].reset(); // Resetea el formulario HTML.
                $('#inputOfficialCountryName').val(''); // Limpia manualmente el campo oficial del país.
                $('#recordId').val(''); // Limpia el ID oculto de edición.
                $('#submitBtn').text('Enviar Formulario'); // Restaura el texto del botón.
                $('#cancelEditBtn').addClass('d-none'); // Oculta el botón de cancelar.
                $form.find('.form-control').removeClass('is-valid'); // Elimina las clases 'is-valid' (verdes).
                $('#div-errores').hide(); // Oculta el contenedor de errores generales.
            });

            // --- Eventos para Editar y Eliminar Registros ---

            // Escucha el evento 'click' en los botones con clase 'edit-btn' (delegación de eventos).
            $('#contactRecordsContainer').on('click', '.edit-btn', function() {
                // Obtiene el ID del registro a editar del atributo 'data-id'.
                const idToEdit = $(this).data('id');
                const records = getRecords(); // Obtiene todos los registros.
                // Encuentra el registro específico a editar por su ID.
                const record = records.find(r => r.id == idToEdit);

                if (record) {
                    // Rellena los campos del formulario con los datos del registro.
                    $('#recordId').val(record.id);
                    $('#inputName').val(record.name);
                    $('#inputPhone').val(record.phone);
                    $('#inputEmail').val(record.email);
                    $('#selectCountry').val(record.countryCode); // Rellena el selector de país.
                    // Rellena el campo de nombre oficial (usa el valor guardado o lo busca si no existe).
                    $('#inputOfficialCountryName').val(record.officialCountryName || getOfficialCountryName(record.countryCode));
                    $('#textareaComentario').val(record.comentarios);

                    // Cambia el texto del botón de envío a 'Actualizar Registro'.
                    $('#submitBtn').text('Actualizar Registro');
                    // Muestra el botón de cancelar edición.
                    $('#cancelEditBtn').removeClass('d-none');

                    // Limpia las clases de validación de Bootstrap para que el usuario pueda empezar a editar sin errores visuales previos.
                    $('#contactForm').find('.form-control').removeClass('is-invalid is-valid');
                    $('#div-errores').hide(); // Oculta cualquier mensaje de error general.

                    // Desplaza la ventana suavemente hasta la parte superior del formulario para que sea visible.
                    $('html, body').animate({
                        scrollTop: $('#contactForm').offset().top - $('nav.navbar').outerHeight() - 20 // Ajusta la posición de scroll.
                    }, 500); // Duración de la animación en milisegundos.
                }
            });

            // Escucha el evento 'click' en los botones con clase 'delete-btn'.
            $('#contactRecordsContainer').on('click', '.delete-btn', function() {
                // Obtiene el ID del registro a eliminar.
                const idToDelete = $(this).data('id');
                // Pide confirmación al usuario.
                if (confirm('¿Estás seguro de que quieres eliminar este registro?')) {
                    let records = getRecords(); // Obtiene todos los registros.
                    // Filtra el array, creando uno nuevo sin el registro a eliminar.
                    records = records.filter(r => r.id != idToDelete);
                    saveRecords(records); // Guarda el array actualizado en LocalStorage.
                    displayRecords(); // Vuelve a mostrar la lista de registros.
                    alert('Registro eliminado exitosamente!'); // Mensaje de éxito.
                }
            });

            // Escucha el evento 'click' en el botón 'Cancelar Edición'.
            $('#cancelEditBtn').on('click', function() {
                $('#contactForm')[0].reset(); // Resetea el formulario.
                $('#inputOfficialCountryName').val(''); // Limpia el campo oficial del país.
                $('#recordId').val(''); // Limpia el ID oculto.
                $('#submitBtn').text('Enviar Formulario'); // Restaura el texto del botón de envío.
                $(this).addClass('d-none'); // Oculta el botón de cancelar edición.
                $('#contactForm').find('.form-control').removeClass('is-invalid is-valid'); // Limpia clases de validación.
                $('#div-errores').hide(); // Oculta el contenedor de errores.
                $('#lista-errores').empty(); // Limpia la lista de errores.
            });
        });
    </script>
</body>
</html>